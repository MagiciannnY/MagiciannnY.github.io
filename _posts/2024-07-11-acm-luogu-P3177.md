---
layout: post
title: "P3177 [HAOI2015] 树上染色"
data: 2024-07-10
tags: acm 树状dp 背包问题
comment: true
toc: false
author: Magiciannny
---

原题链接：[P3177 [HAOI2015] 树上染色](https://www.luogu.com.cn/problem/P3177) 

## 题目描述

有一棵点数为 $n$ 的树，树边有边权。给你一个在 $0 \sim n$ 之内的正整数 $k$ ，你要在这棵树中选择 $k$ 个点，将其染成黑色，并将其他的 $n-k$ 个点染成白色。将所有点染色后，你会获得黑点两两之间的距离加上白点两两之间的距离的和的收益。问收益最大值是多少。

## 输入格式

第一行包含两个整数 $n,k$。

第二到 $n$ 行每行三个正整数 $u, v, w$，表示该树中存在一条长度为 $w$ 的边 $(u, v)$。输入保证所有点之间是联通的。

## 输出格式

输出一个正整数，表示收益的最大值。

## 样例 #1

### 样例输入 #1

```
3 1
1 2 1
1 3 2
```

### 样例输出 #1

```
3
```

## 提示

对于 $100\%$ 的数据，$0 \leq n,k \leq 2000$。

---

## 题解

计算一条边的贡献：
$$
val=(cntLeft_{black}\times cntRgiht_{black} + cntLeft_{white}\times cntRgiht_{white}) \times w
$$
对于节点 $u$ 而言，边 $(u,v)$ 的贡献受其下方的黑色点的数量影响（白色点由黑色点的数量决定），记 $dp[u][j]$ 表示以 $u$ 为根节点且包含 $j$ 个黑色点的子树中所有边的贡献，状态转移（背包问题）如下：
$$
dp[u][j] = \max(dp[u][j], dp[u][j-t]+dp[v][t]+val(u,v))
$$
由于降维外层循环需要倒序遍历。

## 代码

<iframe   src="https://carbon.now.sh/embed?bg=rgba%28222%2C171%2C99%2C1%29&t=duotone-dark&wt=none&l=text%2Fx-c%2B%2Bsrc&width=680&ds=true&dsyoff=20px&dsblur=68px&wc=true&wa=true&pv=31px&ph=42px&ln=false&fl=1&fm=Hack&fs=14px&lh=133%25&si=false&es=2x&wm=false&code=%2523%2520include%2520%253Cbits%252Fstdc%252B%252B.h%253E%250Ausing%2520namespace%2520std%253B%250Aconst%2520int%2520N%2520%253D%25202005%253B%250Atypedef%2520long%2520long%2520ll%253B%250A%250All%2520INF%253B%250Aint%2520n%252C%2520k%253B%250Astruct%2520edge%2520%257B%250A%2520%2520%2520%2520int%2520v%252C%2520w%253B%250A%257D%253B%250Avector%253Cedge%253E%2520G%255BN%255D%253B%250Aint%2520sz%255BN%255D%253B%250All%2520dp%255BN%255D%255BN%255D%253B%250A%250Avoid%2520dfs%28int%2520u%252C%2520int%2520fa%29%2520%257B%250A%2520%2520%2520%2520sz%255Bu%255D%252B%252B%253B%250A%2520%2520%2520%2520dp%255Bu%255D%255B0%255D%2520%253D%2520dp%255Bu%255D%255B1%255D%2520%253D%25200%253B%250A%2520%2520%2520%2520for%2520%28edge%2526%2520e%2520%253A%2520G%255Bu%255D%29%2520%257B%250A%2520%2520%2520%2520%2520%2520%2520%2520int%2520v%2520%253D%2520e.v%252C%2520w%2520%253D%2520e.w%253B%250A%2520%2520%2520%2520%2520%2520%2520%2520if%2520%28v%2520%253D%253D%2520fa%29%2520continue%253B%250A%2520%2520%2520%2520%2520%2520%2520%2520dfs%28v%252C%2520u%29%253B%250A%2520%2520%2520%2520%2520%2520%2520%2520sz%255Bu%255D%2520%252B%253D%2520sz%255Bv%255D%253B%250A%2520%2520%2520%2520%2520%2520%2520%2520for%2520%28int%2520j%2520%253D%2520min%28k%252C%2520sz%255Bu%255D%29%253Bj%2520%253E%253D%25200%253Bj--%29%2520%257B%250A%2520%2520%2520%2520%2520%2520%2520%2520%2520%2520%2520%2520for%2520%28int%2520t%2520%253D%25200%253Bt%2520%253C%253D%2520min%28j%252C%2520sz%255Bv%255D%29%253Bt%252B%252B%29%2520%257B%250A%2520%2520%2520%2520%2520%2520%2520%2520%2520%2520%2520%2520%2520%2520%2520%2520if%2520%28dp%255Bu%255D%255Bj%2520-%2520t%255D%2520%253D%253D%2520INF%29%2520continue%253B%250A%2520%2520%2520%2520%2520%2520%2520%2520%2520%2520%2520%2520%2520%2520%2520%2520ll%2520val%2520%253D%25201LL%2520*%2520t%2520*%2520w%2520*%2520%28k%2520-%2520t%29%2520%252B%25201LL%2520*%2520%28sz%255Bv%255D%2520-%2520t%29%2520*%2520w%2520*%2520%28n%2520-%2520k%2520-%2520sz%255Bv%255D%2520%252B%2520t%29%253B%250A%2520%2520%2520%2520%2520%2520%2520%2520%2520%2520%2520%2520%2520%2520%2520%2520dp%255Bu%255D%255Bj%255D%2520%253D%2520max%28dp%255Bu%255D%255Bj%255D%252C%2520dp%255Bu%255D%255Bj%2520-%2520t%255D%2520%252B%2520dp%255Bv%255D%255Bt%255D%2520%252B%2520val%29%253B%2520%250A%2520%2520%2520%2520%2520%2520%2520%2520%2520%2520%2520%2520%257D%250A%2520%2520%2520%2520%2520%2520%2520%2520%257D%250A%2520%2520%2520%2520%257D%250A%257D%250A%250Aint%2520main%28%29%2520%257B%250A%2520%2520%2520%2520cin%2520%253E%253E%2520n%2520%253E%253E%2520k%253B%250A%2520%2520%2520%2520for%2520%28int%2520i%2520%253D%25201%253Bi%2520%253C%2520n%253Bi%252B%252B%29%2520%257B%250A%2520%2520%2520%2520%2520%2520%2520%2520int%2520u%252C%2520v%252C%2520w%253B%2520cin%2520%253E%253E%2520u%2520%253E%253E%2520v%2520%253E%253E%2520w%253B%250A%2520%2520%2520%2520%2520%2520%2520%2520G%255Bu%255D.push_back%28%257B%2520v%252Cw%2520%257D%29%253B%250A%2520%2520%2520%2520%2520%2520%2520%2520G%255Bv%255D.push_back%28%257B%2520u%252Cw%2520%257D%29%253B%250A%2520%2520%2520%2520%257D%250A%2520%2520%2520%2520memset%28dp%252C%2520%7E0x3f%252C%2520sizeof%28dp%29%29%253B%250A%2520%2520%2520%2520INF%2520%253D%2520dp%255B0%255D%255B0%255D%253B%250A%2520%2520%2520%2520dfs%281%252C%25201%29%253B%250A%2520%2520%2520%2520cout%2520%253C%253C%2520dp%255B1%255D%255Bk%255D%2520%253C%253C%2520%27%255Cn%27%253B%250A%2520%2520%2509return%25200%253B%250A%257D"   style="width: 891px; height: 959px; border:0; transform: scale(1); overflow:hidden;"   sandbox="allow-scripts allow-same-origin"> </iframe>

